<!DOCTYPE html>
<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for HTML5 for Linux version 5.8.0">
  <meta charset="utf-8">
  <meta name="viewport" content=
  "width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <title>Why don’t the simple formulas work?</title>
  <!-- MathJax -->

  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [['\\[', '\\]']]
      }
    };
  </script>
  <script src=
  "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div>
    <h2>Why don’t the simple formulas work?</h2>
  </div>
  <div>
    <p>The following derivation produces two formulas that appear
    equivalent, yet behave differently when implemented.</p>
    <p>What’s going on?</p>
  </div>
  <div>
    <p>Problem: Write a program to find the sum of all multiples of
    3 or 5 up to a given integer <code>n</code>. If a number is a
    multiple of both, count it only once.</p>
    <p>At first glance, this problem looks straightforward. One
    natural approach is to add all multiples of 3, add all
    multiples of 5, and subtract the multiples of 15 once to
    account for double-counting.</p>
  </div>
  <div>
    <p>We can write the sum as:</p>\[ f(n) = (3 + 6 + 9 + \dots) +
    (5 + 10 + 15 + \dots) - (15 + 30 + 45 + \dots) \]
    <p>Each of these is an arithmetic series, so we factor out the
    constants:</p>\[ = 3(1 + 2 + 3 + \dots) + 5(1 + 2 + 3 + \dots)
    - 15(1 + 2 + 3 + \dots) \]
    <p>Let \( S(k) = \frac{1}{2}k(k+1) \) denote the sum of the
    first \( k \) positive integers. Then:</p>\[ = 3S(n/3) +
    5S(n/5) - 15S(n/15) \tag{1} \]
    <p>Expanding this gives:</p>\[ = 3 \cdot
    \frac{1}{2}\frac{n}{3}\left(\frac{n}{3}+1\right) + 5 \cdot
    \frac{1}{2}\frac{n}{5}\left(\frac{n}{5}+1\right) - 15 \cdot
    \frac{1}{2}\frac{n}{15}\left(\frac{n}{15}+1\right) \]
    <p>Which simplifies to:</p>\[ = \frac{n}{2} \left( \frac{n}{3}
    + 1 + \frac{n}{5} + 1 - \frac{n}{15} - 1 \right) \]
    <p>And finally:</p>\[ = \frac{n}{2} \left( \frac{n}{3} +
    \frac{n}{5} - \frac{n}{15} + 1 \tag{2} \right) \]
  </div>
  <div>
    <p>Full Python code (copy-paste):</p>
    <pre>
      # Sum of first k numbers
      def s(k):
          return (k * (k + 1)) // 2

      # From Equation 1
      def ss(n):
          return 3 * s(n // 3) + 5 * s(n // 5) - 15 * s(n // 15)

      # From Equation 2
      def sss(n):
          return (n // 2) * (n // 3 + n // 5 - n // 15 + 1)

      # Testing both implementations:
      # (n, expected)
      tests = [
          (3, 3),
          (5, 8),
          (0, 0),
          (10, 33),
          (1000, 234168),
      ]

      for n, expected in tests:
          print(n, expected, ss(n), sss(n))
        </pre>
  </div>
  <div>
    <p>Output:</p>
    <table border="1" cellpadding="5" cellspacing="0">
      <tr>
        <th>n</th>
        <th>expected</th>
        <th>ss(n)</th>
        <th>sss(n)</th>
      </tr>
      <tr>
        <td>3</td>
        <td>3</td>
        <td>3</td>
        <td>2</td>
      </tr>
      <tr>
        <td>5</td>
        <td>8</td>
        <td>8</td>
        <td>6</td>
      </tr>
      <tr>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
      </tr>
      <tr>
        <td>10</td>
        <td>33</td>
        <td>33</td>
        <td>30</td>
      </tr>
      <tr>
        <td>1000</td>
        <td>234168</td>
        <td>234168</td>
        <td>234000</td>
      </tr>
    </table>
    <p>The function <code>ss</code> produces the correct result.
    The function <code>sss</code> does not.</p>
    <p>Both come from the same derivation. Both look algebraically
    equivalent.</p>
    <p>So why do they behave differently?</p>
  </div>
</body>
</html>
